"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7575],{6168:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var s=r(5893),t=r(1151);const a={sidebar_position:4},i="Comprendre et utiliser Ansible",l={id:"test",title:"Comprendre et utiliser Ansible",description:"Etapes pour utiliser ansible:",source:"@site/docs/test.md",sourceDirName:".",slug:"/test",permalink:"/docs/test",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/test.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Translate your site",permalink:"/docs/tutorial-extras/translate-your-site"}},o={},c=[];function u(e){const n={code:"code",h1:"h1",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"comprendre-et-utiliser-ansible",children:"Comprendre et utiliser Ansible"}),"\n",(0,s.jsx)(n.p,{children:"Etapes pour utiliser ansible:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"creer conteneur serveur-web (nom_conteneur)"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"lxc launch ubuntu:22:04 nom_conteneur\n"})}),"\n",(0,s.jsx)(n.p,{children:"Cette comande creer un ubuntu 22.04. vous pouvez utiliser la distribution linux souhait\xe9."}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"creer ou mettre cle ssh publique dans authorized_keys situ\xe9 dans /home/student/.ssh.\r\nVous pouvez copier la cl\xe9 public directement avec la commande lxc file push pour ne pas aller dans le conteneur :"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"lxc file push ~/.ssh/id_rsa.pub test-ansible/root/.ssh/authorized_keys\n"})}),"\n",(0,s.jsx)(n.p,{children:"Vous pouvez la mettere dans le worflows github action."}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"creer .ansible.cfg a la racine utlisateur avec :"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"[defaults]\r\ninventory = ~/ansible/etc/hosts\r\nremote_user = root\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"creer le dossier etc avec un fichier host:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"testmariadb-ansible ansible_host=10.42.42.249\r\nserveur-test ansible_host=10.42.42.58\r\nnomconteneur ansible_host=ipconteneur\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"faire un test ansible avec ansible -m ping testmariadb-ansible\r\naccepter le fingerprint."}),"\n",(0,s.jsx)(n.li,{children:"creer runner dans ubuntu pas conteneur"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"ansible -u root -m ping testmariadb-ansible\r\nansible -m ping testmariadb-ansible"}),"\n",(0,s.jsx)(n.p,{children:"ansible-playbook -i etc/host ./recette.yml"}),"\n",(0,s.jsx)(n.p,{children:"ansible-playbook ./recette.yml : pour executer le yml"}),"\n",(0,s.jsx)(n.p,{children:"exemple de recette :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"---\r\n- name: toto.txt\r\n  hosts: ansible-test (nom du conteneur) ou all\r\n  remote_user: root\r\n  \r\n  roles:\r\n  - mariadb\r\n  - apache\r\n\r\n  tasks:\r\n  - name: create empty toto.txt file\r\n    ansible.builtin.file:\r\n      path: /etc/toto.txt\r\n      state: touch\r\n\r\n  - name: install needed packages\r\n    ansible.builtin.apt:\r\n      name: cowsay\r\n      state: present\r\n      update_cache: yes\n"})}),"\n",(0,s.jsx)(n.p,{children:"exemple de worflows github action pour demarer ansible :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"name: Deploy Ansible playbooks\r\n\r\non:\r\n  push:\r\n  workflow_dispatch:\r\njobs:\r\n  run-ansible:\r\n    runs-on: self-hosted\r\n\r\n\r\n    steps:\r\n      - name: Check Out Repository\r\n        uses: actions/checkout@v4\r\n        \r\n      - name: copy ansible files\r\n        run: |\r\n          rsync -av -P ansible /home/student\n"})}),"\n",(0,s.jsx)(n.p,{children:"ansible module"}),"\n",(0,s.jsx)(n.p,{children:"Definition:\r\nTask : tache a realiser par ansible\r\nRoles : ensemble de tache (tasks)\r\nFiles : fichier de lancement (fichier source de site) index.html, fichier de travail, configuration\r\nHandlers : configuration systeme (start,restart apache), si notify dans tache de role alors execute sont handlers SI modification de cette partie de tache\r\nTemplate : pour mettre des variables, des boucles...\r\nHost : par defaut goupe all on peut mettre un groupe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"[test-ansible]\n"})}),"\n",(0,s.jsx)(n.p,{children:"first ansible_host\r\nVariable : situ\xe9 dans etc/host_vars/nomserveur.yml\r\ntiti: toto"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ansible\r\n\u251c\u2500\u2500 etc\r\n\u2502\xa0\xa0 \u2514\u2500\u2500 hosts\r\n|   |___host_vars\r\n|   |    |___serveur-web.yml\r\n|   | \r\n|   |___group_vars\r\n|       \r\n\u2514\u2500\u2500 playbook\r\n    \u2514\u2500\u2500 recette.yml\r\n        roles\r\n         |__ apache\r\n                |___ tasks  \r\n                |     |___main.yml   \r\n                |         \r\n                |____files\r\n                |      |___index.yml\r\n                |          security.conf (parametre securit\xe9 apache)\r\n                |____handlers\r\n                |     |____main.yml  \r\n                |\r\n                |____templates\n"})}),"\n",(0,s.jsx)(n.p,{children:"role:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"---\r\n  - name: Install Apache2\r\n    ansible.builtin.apt:\r\n      name: apache2\r\n      state: present\r\n      update_cache: true\r\n\r\n  - name: Create a new database with name 'writefreely'\r\n    mysql_db:\r\n      name: writefreely\r\n      state: present\r\n\r\n\r\n  - name: Create database user with name 'benjamin' and password 'azertyuio' with all database privileges\r\n    mysql_user:\r\n      name: benjamin\r\n      password: 123456\r\n      priv: '*writefreely*:ALL'\r\n      state: present\n"})}),"\n",(0,s.jsx)(n.p,{children:"rsync -av --delete -P ansible /home/student"})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>i});var s=r(7294);const t={},a=s.createContext(t);function i(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);